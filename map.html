<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8 />
	<title>Bay Area Bike Share</title>

	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
	<script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.js'></script>
	<script src='http://code.jquery.com/jquery-1.11.0.min.js'></script>
	<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.css' rel='stylesheet' />

	<style>
		body { margin:0; padding:0; }
		#map { position:absolute; top:0; bottom:0; width:100%; }
	</style>
</head>
<body>
	<h1>Top 10 traveled routes by Subscribers</h1>
	<div id='map'></div>
	<script>
		var geocoder = L.mapbox.geocoder('pamo.hlc07n47'),
		map = L.mapbox.map('map', 'pamo.hlc07n47');

		geocoder.query('San Francisco, CA', showMap);

		function showMap(err, data) {
			map.fitBounds(data.lbounds);
		}

		$.get('results.csv', function(data) {
			var routes = $.csv.toObjects(data);
			$.each(routes, function(i, route) {
				var startLatLng = L.latLng(route.start_lat,route.start_long);
				var endLatLng = L.latLng(route.end_lat,route.end_long);
				L.mapbox.featureLayer({
					type: 'Feature',
					geometry: {
						type: 'Point',
						coordinates: [route.start_long,route.start_lat]
					},
					properties: {
						title: route.start,
						'marker-color': '#7ec9b1'
					}
				}).addTo(map);
				L.mapbox.featureLayer({
					type: 'Feature',
					geometry: {
						type: 'Point',
						coordinates: [route.end_long,route.end_lat]
					},
					properties:  {
						title: route.end,
						'marker-color': '#f86767'
					}
				}).addTo(map);
				L.polyline([startLatLng, endLatLng], {color: '#f5c272'}).addTo(map);
			})
		})
	</script>
</body>
</html>